<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Oxygen Gauge Test Harness</title>
  </head>
  <body>
    <div class="container">
      <h1>Oxygen Gauge Test</h1>

      <div class="gauge-container">
        <!-- --------------------------------------------------- -->
        <!-- STUDENT INSTRUCTIONS -->
        <!-- Students: Make your instruments illustration in Figma/Illustrator (vector only) and save as .SVG -->
        <!-- In Illustrator,  Save As SVG  In SVG Options Screen, Click Button "SVG Coder..." -->
        <!-- This opens the code in Text Edit. Select All, & Copy-->
        <!-- Paste your SVG below. Should start with something like <?xml version="1.0" encoding="UTF-8"?> <svg id="oxygen" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 256" style="width: 100%; max-width: 512px; height: auto">-->
        <!-- In TextEdit > Settings > Open and Save. Uncheck "Display HTML files as HTML code instead of formatted text" -->

        <!-- --------------------------------------------------- -->

        <?xml version="1.0" encoding="UTF-8"?>
        <svg
          id="oxygen"
          xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink"
          version="1.1"
          viewBox="0 0 400 400"
          aria-labelledby="title desc"
          role="img"
        >
          <title id="title">Oxygen Gauge VU style</title>
          <desc id="desc">Square retro VU-style oxygen gauge with functional needle pivoting around fixed point.</desc>

          <defs>
            <linearGradient id="faceGrad" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#f7f1e3" />
              <stop offset="100%" stop-color="#e9dfc8" />
            </linearGradient>
            <linearGradient id="glassGrad" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#fff" stop-opacity="0.5" />
              <stop offset="0.4" stop-color="#fff" stop-opacity="0.15" />
              <stop offset="1" stop-color="#fff" stop-opacity="0" />
            </linearGradient>

            <style>
              .bezel {
                fill: #2b2b2b;
                stroke: #111;
                stroke-width: 3;
              }
              .face {
                fill: url(#faceGrad);
                stroke: #b5ad93;
                stroke-width: 2;
              }
              .glass {
                fill: url(#glassGrad);
                pointer-events: none;
              }
              .tick {
                stroke: #222;
                stroke-width: 2;
                stroke-linecap: round;
              }
              .tick.minor {
                stroke-width: 1.2;
                opacity: 0.85;
              }
              .tick.hot {
                stroke: #c22;
              }
              .num {
                font-family: "Helvetica Neue", Arial, sans-serif;
                font-size: 13px;
                fill: #222;
                text-anchor: middle;
              }
              .label {
                font-family: "Helvetica Neue", Arial, sans-serif;
                font-weight: 700;
                font-size: 20px;
                fill: #222;
                letter-spacing: 1px;
              }
              .needle {
                stroke: #111;
                stroke-width: 3;
                stroke-linecap: round;
              }
              .needleTip {
                stroke: #c22;
                stroke-width: 2.5;
              }
              .pivot {
                fill: #111;
                stroke: #333;
                stroke-width: 1;
              }
            </style>
          </defs>

          <!-- Outer frame -->
          <rect x="10" y="10" width="380" height="380" rx="12" ry="12" class="bezel" />
          <rect x="25" y="25" width="350" height="350" rx="10" ry="10" class="face" />

          <!-- Pivot and arc center geometry:
       center = (200,200)
       needle pivot = (200,260)
       arc radius approx 130
       sweep angles: -150 ... -30 (120Â°) across top of gauge
  -->

          <!-- Arc decorative (subtle) -->
          <path d="M 87.42 195 A 130 130 0 0 1 312.58 195" fill="none" stroke="#d8d0b6" stroke-width="1" opacity="0.6" />

          <!-- MAJOR TICKS (0,20,40,60,80,100) computed explicitly so orientation is fixed -->
          <!-- Format: <line x1,y1 (inner) x2,y2 (outer)> -->
          <g id="major-ticks">
            <!-- 0%  angle -150 -->
            <line class="tick" x1="113.40" y1="210.00" x2="87.42" y2="195.00" />
            <!-- 20% angle -126 -->
            <line class="tick" x1="141.22" y1="179.10" x2="123.59" y2="154.83" />
            <!-- 40% angle -102 -->
            <line class="tick" x1="179.21" y1="162.19" x2="172.97" y2="132.84" />
            <!-- 60% angle -78 -->
            <line class="tick" x1="220.79" y1="162.19" x2="227.03" y2="132.84" />
            <!-- 80% angle -54 -->
            <line class="tick" x1="258.78" y1="179.10" x2="276.41" y2="154.83" />
            <!-- 100% angle -30 -->
            <line class="tick hot" x1="286.60" y1="210.00" x2="312.58" y2="195.00" />
          </g>

          <!-- MINOR TICKS (10,30,50,70,90) -->
          <g id="minor-ticks">
            <!-- 10% angle -138 -->
            <line class="tick minor" x1="114.54" y1="183.05" x2="103.39" y2="173.01" />
            <!-- 30% angle -114 -->
            <line class="tick minor" x1="153.23" y1="154.94" x2="147.12" y2="141.24" />
            <!-- 50% angle -90 -->
            <line class="tick minor" x1="200.00" y1="145.00" x2="200.00" y2="130.00" />
            <!-- 70% angle -66 -->
            <line class="tick minor" x1="246.77" y1="154.94" x2="252.88" y2="141.24" />
            <!-- 90% angle -42 -->
            <line class="tick hot minor" x1="285.46" y1="183.05" x2="296.61" y2="173.01" />
          </g>

          <!-- NUMERIC LABELS placed along the arc interior -->
          <g id="labels">
            <text class="num" x="126.39" y="217.50">0</text>
            <text class="num" x="150.04" y="191.23">20</text>
            <text class="num" x="182.33" y="176.86">40</text>
            <text class="num" x="217.67" y="176.86">60</text>
            <text class="num" x="249.96" y="191.23">80</text>
            <text class="num" x="273.61" y="217.50">100</text>
          </g>

          <!-- Needle: defined vertically up (x2 = 200, y2 = 140) and initially rotated to -150deg
       Pivot MUST remain x1="200" y1="260" for your handler to work unchanged. -->
          <g id="needleGroup">
            <line id="line" x1="200" y1="260" x2="200" y2="140" class="needle" transform="rotate(0 200 260)" />
            <line x1="200" y1="140" x2="200" y2="130" class="needleTip" transform="rotate(0 200 260)" />
            <circle cx="200" cy="260" r="6" class="pivot" />
            <circle cx="200" cy="260" r="3" fill="#fff" opacity="0.08" />
          </g>

          <!-- Label -->
          <text x="200" y="310" text-anchor="middle" class="label">OXYGEN</text>
          <text x="200" y="332" text-anchor="middle" font-size="12" fill="#444" font-family="Helvetica, Arial">percent</text>

          <!-- Glass overlay -->
          <rect x="25" y="25" width="350" height="350" rx="10" ry="10" class="glass" />

          <!-- Load external animation script -->
        </svg>

        <!--   END SVG PASTE-->
        <!--   END SVG PASTE-->
        <!--   END SVG PASTE-->
      </div>

      <div class="controls">
        <div class="control-group">
          <label for="oxygenSlider">Oxygen Control:</label>
          <input type="range" id="oxygenSlider" min="0" max="100" value="50" step="1" />
          <div class="value-display">
            <span>0%</span>
            <span id="oxygenValue">50%</span>
            <span>100%</span>
          </div>
        </div>
      </div>

      <div class="info">
        <h3>How To Update</h3>
        <ul>
          <li>Make your instruments illustration in Figma/Illustrator (vector only) and save as .SVG</li>
          <li>In Illustrator, Save As SVG In SVG Options Screen, Click Button "SVG Coder..."</li>
          <li>This opens the code in Text Edit. Select All, & Copy</li>
          <li>Open this html file in TextEdit. Paste your SVG to replace the existing SVG in the indicated area.</li>
          <li>Remember: In TextEdit > Settings > Open and Save. Uncheck "Display HTML files as HTML code instead of formatted text"</li>
        </ul>
        <h3>How This Works:</h3>
        <ul>
          <li>There is a <code>oxygen.svg</code> file. For the purposes of this demo, the student pastes the SVG contents in this HTML page</li>
          <li>The HTML loads <code>oxygen.js</code> which contains the <code>update_oxygen()</code> function</li>
          <li>The slider updates <code>localStorage.setItem('game_oxygen', value)</code></li>
          <li>After page load, <code>setInterval</code> calls <code>update_oxygen()</code> every 50ms</li>
          <li>When it detects a change, it rotates the needle to show oxygen level</li>
        </ul>
      </div>
    </div>

    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #1a1a1a;
        color: white;
        padding: 20px;
        margin: 0;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
      }

      h1 {
        text-align: center;
        margin-bottom: 30px;
      }

      .gauge-container {
        background-color: #2a2a2a;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 30px;
        text-align: center;
      }

      .controls {
        background-color: #2a2a2a;
        padding: 20px;
        border-radius: 8px;
      }

      .control-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 10px;
        font-weight: bold;
      }

      input[type="range"] {
        width: 100%;
        height: 8px;
        border-radius: 5px;
        background: #444;
        outline: none;
        -webkit-appearance: none;
        appearance: none;
      }

      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #4caf50;
        cursor: pointer;
      }

      input[type="range"]::-moz-range-thumb {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #4caf50;
        cursor: pointer;
        border: none;
      }

      .value-display {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
        font-size: 18px;
      }

      .value-display span {
        color: #4caf50;
        font-weight: bold;
      }

      .info {
        background-color: #2a2a2a;
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
        font-size: 14px;
        line-height: 1.6;
      }

      .info code {
        background-color: #444;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: "Courier New", monospace;
      }
    </style>
    <script>
      const slider = document.getElementById("oxygenSlider");
      const valueDisplay = document.getElementById("oxygenValue");

      slider.addEventListener("input", function () {
        const value = this.value;
        localStorage.setItem("game_oxygen", value);
        valueDisplay.textContent = value + "%";
      });

      localStorage.setItem("game_oxygen", slider.value);
    </script>

    <!-- Load oxygen.js -->
    <script src="oxygen.js"></script>

    <script>
      // Wait for everything to be fully loaded, then start the update interval
      window.addEventListener("load", function () {
        // Alert designer if the file is missing the ID tag with the file name ( or code won't work!)
        const filename = window.location.pathname.split("/").pop().split(".")[0];
        if (!document.getElementById(filename)) {
          alert("Missing the SVG file or the ID tag in the file");
          return;
        }

        setInterval(update_oxygen, 50);
      });
    </script>
  </body>
</html>
